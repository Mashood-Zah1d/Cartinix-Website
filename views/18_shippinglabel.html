<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shipping Label</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- html2pdf library -->
  <script src="https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>

  <style>
    body {
      background: #f1f1f1;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }

    .label-container {
      width: 600px;
      background: white;
      padding: 20px 30px;
      margin: auto;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.15);
      page-break-inside: avoid;
      break-inside: avoid;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 22px;
      color: #333;
    }

    .section {
      margin-bottom: 20px;
      page-break-inside: avoid;
      break-inside: avoid;
    }

    .section h4 {
      margin-bottom: 10px;
      color: #444;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }

    .info-row {
      margin-bottom: 5px;
      font-size: 16px;
    }

    .label-buttons {
      text-align: center;
      margin-top: 30px;
    }

    .btn {
      background: #007bff;
      color: white;
      padding: 8px 16px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .btn:hover {
      background: #0056b3;
    }

    @media print {
      .btn {
        display: none;
      }

      body {
        background: white;
      }

      .label-container {
        box-shadow: none;
        border: none;
      }
    }
  </style>
</head>
<body>

  <div class="label-container" id="label">
    <h2>Shipping Label</h2>
    <div id="responseMessage" class="text-center mb-3 fw-semibold"></div>
    <div class="section">
      <h4>Customer Details</h4>
      <div class="info-row"><strong>Name: </strong><span id="name"></span></div>
      <div class="info-row"><strong>Address: </strong><span id="address"></span></div>
      <div class="info-row"><strong>Phone: </strong><span id="phone"></span></div>
      <div class="info-row"><strong>Email: </strong><span id="email"></span></div>
    </div>

    <div class="section">
      <h4>Sender Details</h4>
      <div class="info-row"><strong>Name:</strong> Cartinix</div>
      <div class="info-row"><strong>Address:</strong> 3/d 4/9 Nazimabad No 4</div>
      <div class="info-row"><strong>Phone:</strong> 0331-4745405</div>
      <div class="info-row"><strong>Email:</strong> cartinixoffical@gmail.com</div>
    </div>

    <div class="section">
      <h4>Order Info</h4>
      <div class="info-row"><strong>Order ID: </strong><span id="orderid"></span></div>
      <div class="info-row"><strong>Product SKU: </strong><span id="sku"></span></div>
      <div class="info-row"><strong>Quantity: </strong><span id="quantity"></span></div>
      <div class="info-row"><strong>Order Date: </strong><span id="date"></span></div>
      <div class="info-row"><strong>Amount: </strong><span id="amount"></span></div>
    </div>
  </div>

  <div class="label-buttons">
    <button class="btn" id="download">Download Label</button>
  </div>

  <script>
    const sku = localStorage.getItem("selectedorder");
    const orderid = localStorage.getItem("seletedorderid");
    const alert = document.getElementById("responseMessage");
    fetch(`http://localhost:8000/orderdetails?sku=${sku}&orderid=${orderid}`)
      .then(async res => {
        if (!res.ok) {
          const text = await res.json();
          window.scrollTo({top:0 , behavior:"smooth"});s
          alert.innerHTML = `<h5>${text.err}</h5>`;
          alert.style.color = 'red'    
          return;
        }
        return res.json(); 
      })
      .then(data => {
        document.getElementById("name").innerText = data.customer_name;
        document.getElementById("address").innerText = data.customer_address;
        document.getElementById("phone").innerText = data.customer_phone;
        document.getElementById("email").innerText = data.customer_email;
        document.getElementById("orderid").innerText = data.order_id;
        document.getElementById("sku").innerText = data.sku;
        document.getElementById("date").innerText = data.order_date;
        document.getElementById("amount").innerText = data.price;
        document.getElementById("quantity").innerText = data.quantity;
      })
      .catch(err=>{
         window.scrollTo({top:0 , behavior:"smooth"});s
        alert.innerHTML = `<h5>${err.message}</h5>`;
        alert.style.color = 'red'    
      })

    document.getElementById("download").addEventListener("click", (e) => {
      e.preventDefault();
      const element = document.getElementById("label");
     html2pdf().set({
     margin: 0.5,
     filename: 'shipping_label.pdf',
     image: { type: 'jpeg', quality: 0.98 },
     html2canvas: {
    scale: 2,
    scrollY: 0
  },
  jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
  pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
}).from(element).save();

    });
  </script>

</body>
</html>
